<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Russisch Drill: Pronomina (Sofort-Feedback)</title>
    <!-- WICHTIG: Polyfill f√ºr Touch-Ger√§te (Tablets/Handys) -->
    <script src="https://cdn.jsdelivr.net/npm/drag-drop-touch@1.3.1/DragDropTouch.js"></script>
    <style>
        :root {
            --primary: #3f51b5;
            --primary-light: #c5cae9;
            --bg-color: #f4f4f9;
            --card-bg: #ffffff;
            --success: #4caf50;
            --error: #f44336;
            --text-color: #333;
            --border-light: #e0e0e0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        h1 {
            color: var(--primary);
            text-align: center;
            margin-top: 0;
            font-size: 1.6rem;
        }

        .intro {
            background-color: #e8eaf6;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            color: #555;
            text-align: center;
            border-left: 5px solid var(--primary);
        }

        /* --- GRID LAYOUT --- */
        .matching-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .column-header {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary);
            text-align: center;
            margin-bottom: 10px;
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 5px;
        }

        /* Linke Spalte (Vorrat) */
        .source-bank {
            border: 2px dashed #ccc;
            border-radius: 10px;
            min-height: 300px;
            padding: 10px;
            background-color: #fafafa;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-content: flex-start;
            justify-content: center;
        }

        /* Rechte Spalte (Ziele) */
        .drop-targets-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-height: 300px;
        }

        /* --- DRAGGABLE ITEMS (K√§rtchen) --- */
        .draggable-pronoun {
            background-color: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: bold;
            cursor: grab;
            user-select: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 100;
            transition: transform 0.1s;
        }

        .draggable-pronoun:active {
            cursor: grabbing;
            transform: scale(1.05);
        }

        /* Wenn das Item "richtig" platziert ist, kann man es sperren oder gr√ºn f√§rben */
        .draggable-pronoun.locked {
            cursor: default;
            box-shadow: none;
        }

        /* --- DROPZONES (Zielboxen) --- */
        .drop-target {
            background-color: white;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: space-between; /* Text links, Platzhalter rechts */
            padding: 0 15px;
            position: relative;
            transition: all 0.2s ease;
        }

        /* Beschriftung der Zielbox (Dativ-Form) */
        .target-label {
            font-weight: bold;
            color: #555;
            font-size: 1.1rem;
        }

        .drop-target.drag-over {
            background-color: #e3f2fd;
            border-color: var(--primary);
            border-style: dashed;
            transform: scale(1.02);
        }

        /* --- FEEDBACK STATES (SOFORT) --- */
        
        /* Richtig */
        .drop-target.correct {
            background-color: #e8f5e9;
            border-color: var(--success);
        }
        .drop-target.correct .target-label {
            color: var(--success);
        }
        .drop-target.correct .draggable-pronoun {
            background-color: var(--success);
        }

        /* Falsch */
        .drop-target.incorrect {
            background-color: #ffebee;
            border-color: var(--error);
            animation: shake 0.4s;
        }
        .drop-target.incorrect .target-label {
            color: var(--error);
        }
        .drop-target.incorrect .draggable-pronoun {
            background-color: var(--error);
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        /* --- BUTTONS --- */
        .controls {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        button.action-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            color: white;
            transition: opacity 0.2s;
            min-width: 140px;
        }
        button.action-btn:hover { opacity: 0.9; }

        .btn-reset { background-color: #757575; }
        .btn-solve { background-color: #ff9800; }

        .feedback-display {
            text-align: center;
            margin-top: 15px;
            font-weight: bold;
            min-height: 24px;
        }

        /* Mobile Adjustments */
        @media (max-width: 600px) {
            .matching-area {
                grid-template-columns: 1fr 1fr; /* Bleibt nebeneinander, aber enger */
                gap: 10px;
            }
            .draggable-pronoun {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            .target-label {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Zuordnung: Wer ‚ûî Wem?</h1>
    
    <div class="intro">
        Ziehen Sie das Pronomen (links) in die Box mit der passenden Dativ-Form (rechts).
        <br><strong>Sofort-Feedback:</strong> Gr√ºn = Richtig, Rot = Falsch.
    </div>

    <div class="matching-area">
        <!-- Links: Vorrat -->
        <div>
            <div class="column-header">Nominativ (Wer?)</div>
            <div class="source-bank" id="source-bank">
                <!-- Items per JS -->
            </div>
        </div>

        <!-- Rechts: Ziele -->
        <div>
            <div class="column-header">Dativ (Wem?)</div>
            <div class="drop-targets-container" id="targets-container">
                <!-- Targets per JS -->
            </div>
        </div>
    </div>

    <div class="feedback-display" id="main-feedback"></div>

    <div class="controls">
        <button class="action-btn btn-reset" onclick="resetGame()">Zur√ºcksetzen</button>
        <button class="action-btn btn-solve" onclick="showSolution()">L√∂sung anzeigen</button>
    </div>
</div>

<script>
    // --- DATEN ---
    // nominativ = das bewegliche Teil, dativ = das feste Ziel
    const pairs = [
        { nom: "–Ø", dat: "–ú–Ω–µ" },
        { nom: "–¢—ã", dat: "–¢–µ–±–µ" },
        { nom: "–û–Ω", dat: "–ï–º—É" },
        { nom: "–û–Ω–∞", dat: "–ï–π" },
        { nom: "–ú—ã", dat: "–ù–∞–º" },
        { nom: "–í—ã", dat: "–í–∞–º" },
        { nom: "–û–Ω–∏", dat: "–ò–º" },
        { nom: "–ö—Ç–æ", dat: "–ö–æ–º—É" }
    ];

    const sourceBank = document.getElementById('source-bank');
    const targetsContainer = document.getElementById('targets-container');
    const mainFeedback = document.getElementById('main-feedback');

    // --- INITIALISIERUNG ---
    function init() {
        renderGame();
        setupDragAndDrop();
    }

    function renderGame() {
        sourceBank.innerHTML = "";
        targetsContainer.innerHTML = "";
        mainFeedback.innerHTML = "";

        // 1. ZIELBOXEN erstellen (feste Reihenfolge)
        pairs.forEach(pair => {
            const box = document.createElement('div');
            box.className = 'drop-target';
            box.dataset.correctNom = pair.nom; // Wir speichern, was hier rein geh√∂rt
            box.id = `target-${pair.dat}`;
            
            // Beschriftung
            const label = document.createElement('span');
            label.className = 'target-label';
            label.textContent = pair.dat;
            box.appendChild(label);

            targetsContainer.appendChild(box);
        });

        // 2. K√ÑRTCHEN erstellen (gemischt)
        const shuffled = [...pairs].sort(() => Math.random() - 0.5);
        
        shuffled.forEach((pair, index) => {
            const item = document.createElement('div');
            item.className = 'draggable-pronoun';
            item.draggable = true;
            item.textContent = pair.nom;
            item.id = `drag-${index}`; // Unique ID
            item.dataset.nom = pair.nom; // Welches Pronomen bin ich?
            
            sourceBank.appendChild(item);
        });
    }

    // --- DRAG & DROP LOGIK ---

    function setupDragAndDrop() {
        let draggedItem = null;

        // 1. Drag Start
        document.addEventListener('dragstart', (e) => {
            if (e.target.classList.contains('draggable-pronoun')) {
                draggedItem = e.target;
                e.target.style.opacity = '0.5';
                e.dataTransfer.effectAllowed = 'move';
                // Wichtig f√ºr Firefox:
                e.dataTransfer.setData('text/plain', e.target.id);
            }
        });

        // 2. Drag End (Cleanup)
        document.addEventListener('dragend', (e) => {
            if (e.target.classList.contains('draggable-pronoun')) {
                e.target.style.opacity = '1';
                draggedItem = null;
            }
        });

        // 3. Drag Over (Erlauben)
        document.addEventListener('dragover', (e) => {
            // Wir erlauben Drop auf Source-Bank und Drop-Targets
            const targetZone = e.target.closest('.drop-target') || e.target.closest('.source-bank');
            if (targetZone) {
                e.preventDefault(); // Drop erlauben
                e.dataTransfer.dropEffect = 'move';
                
                // Visuelles Highlight nur bei Drop-Targets
                if (targetZone.classList.contains('drop-target')) {
                    targetZone.classList.add('drag-over');
                }
            }
        });

        // 4. Drag Leave (Highlight entfernen)
        document.addEventListener('dragleave', (e) => {
            const targetZone = e.target.closest('.drop-target');
            if (targetZone) {
                targetZone.classList.remove('drag-over');
            }
        });

        // 5. DROP (Die Hauptlogik)
        document.addEventListener('drop', (e) => {
            e.preventDefault();
            
            // Highlight entfernen
            const dropZone = e.target.closest('.drop-target');
            if (dropZone) dropZone.classList.remove('drag-over');

            const sourceZone = e.target.closest('.source-bank');

            // ID holen (f√ºr Firefox Robustheit)
            const id = e.dataTransfer.getData('text/plain');
            const item = document.getElementById(id);

            if (!item) return;

            // FALL A: Drop in eine Zielbox
            if (dropZone) {
                // Gibt es dort schon ein Item?
                const existingItem = dropZone.querySelector('.draggable-pronoun');
                
                // Wenn ja, zur√ºck in die Bank damit (Swap)
                if (existingItem) {
                    sourceBank.appendChild(existingItem);
                }

                // Neues Item einf√ºgen
                dropZone.appendChild(item);

                // SOFORTIGE PR√úFUNG
                validateDrop(dropZone, item);
                checkGlobalWin();
            }
            // FALL B: Zur√ºck in die Bank
            else if (sourceZone) {
                // Wenn es vorher in einer Zone war, diese "s√§ubern" (Farben weg)
                if (item.parentElement.classList.contains('drop-target')) {
                    resetZoneVisuals(item.parentElement);
                }
                sourceBank.appendChild(item);
                // Item selbst auch s√§ubern (Farbe weg)
                item.style.backgroundColor = ""; // Reset inline styles if any
                item.classList.remove('locked');
            }
        });
    }

    // Pr√ºft EINE Zone sofort nach dem Drop
    function validateDrop(zone, item) {
        const correctNom = zone.dataset.correctNom;
        const currentNom = item.dataset.nom;

        // Reset classes first
        zone.classList.remove('correct', 'incorrect');

        if (correctNom === currentNom) {
            // Richtig
            zone.classList.add('correct');
            // Optional: Sound playSuccess();
        } else {
            // Falsch
            zone.classList.add('incorrect');
            // Optional: Sound playError();
        }
    }

    // Entfernt Farben von einer Zone (wenn leer)
    function resetZoneVisuals(zone) {
        zone.classList.remove('correct', 'incorrect', 'drag-over');
    }

    // Pr√ºft, ob ALLES fertig ist
    function checkGlobalWin() {
        const totalTargets = document.querySelectorAll('.drop-target').length;
        const correctTargets = document.querySelectorAll('.drop-target.correct').length;

        if (totalTargets === correctTargets) {
            mainFeedback.innerHTML = "<span style='color:green; font-size:1.2rem;'>üéâ Perfekt! Alles richtig.</span>";
        } else {
            mainFeedback.innerHTML = "";
        }
    }

    // --- STEUERUNG ---

    function resetGame() {
        // Alles leeren und neu rendern
        renderGame();
    }

    function showSolution() {
        // Resetten um Konflikte zu vermeiden
        resetZoneVisuals(document.body); // Dummy call, we iterate below
        
        // Iteriere durch alle Boxen
        const zones = document.querySelectorAll('.drop-target');
        
        zones.forEach(zone => {
            // Reset Zone
            zone.classList.remove('incorrect');
            
            const neededNom = zone.dataset.correctNom;
            
            // Finde das passende Item (egal wo es ist)
            // Wir suchen nach dem dataset.nom im ganzen Dokument
            // Da IDs unique sind, m√ºssen wir das Element finden.
            
            // Alle Items holen
            const allItems = Array.from(document.querySelectorAll('.draggable-pronoun'));
            const correctItem = allItems.find(i => i.dataset.nom === neededNom);
            
            if (correctItem) {
                // Wenn in der Zone schon ein Falsches liegt, rauswerfen
                const existing = zone.querySelector('.draggable-pronoun');
                if (existing && existing !== correctItem) {
                    sourceBank.appendChild(existing);
                }
                
                // Richtiges einf√ºgen
                zone.appendChild(correctItem);
                
                // Als Richtig markieren
                validateDrop(zone, correctItem);
            }
        });
        
        checkGlobalWin();
        mainFeedback.innerHTML = "<span style='color:#ff9800;'>L√∂sung angezeigt.</span>";
    }

    // Start
    window.addEventListener('DOMContentLoaded', init);

</script>

</body>
</html>